# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

salesman table

name                 type
---------------   ---------------
salesman_id       numeric(5)
name                  varchar(30)
city                     varchar(15)
commission       decimal(5,2)

customer table

name              type
-----------       ----------
customer_id   int
cust_name     text
city                text
grade            int
salesman_id  int
-- 

```sql
SELECT s.salesman_id, s.name
FROM salesman s
JOIN customer c
  ON s.salesman_id = c.salesman_id
GROUP BY s.salesman_id, s.name
HAVING COUNT(c.customer_id) > 1;

```

**Output:**

<img width="1367" height="471" alt="image" src="https://github.com/user-attachments/assets/5a538e04-6255-4bc5-b29f-b71df234a983" />

**Question 2**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million

Employee Table

name             type

------------   ---------------

id                    INTEGER

name                  TEXT

age                  INTEGER

city                  TEXT

income               INTEGER

-- 

```sql
SELECT *
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 1000000
);

```

**Output:**

<img width="1416" height="432" alt="image" src="https://github.com/user-attachments/assets/cdf6b836-434e-4d69-9cfc-2a496eab867d" />



**Question 3**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/94b36cf7-608c-4388-8c1d-0e82038ced46" />


--

```sql
SELECT student_name, grade
FROM GRADES
WHERE (subject, grade) IN (
    SELECT subject, MIN(grade)
    FROM GRADES
    GROUP BY subject
);

```

**Output:**

<img width="1053" height="443" alt="image" src="https://github.com/user-attachments/assets/576db8e7-6f9b-468a-bcf8-144ae3fdf04c" />


**Question 4**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is LESS than $2500.

Sample table: CUSTOMERS


```sql
SELECT *
FROM CUSTOMERS
WHERE SALARY < 2500;

```

**Output:**
<img width="1213" height="465" alt="image" src="https://github.com/user-attachments/assets/172e0e36-ff84-49eb-9a0d-1c4fc103556a" />



**Question 5**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

Table Name: orders

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
-- 

```sql
SELECT
    ord_no,
    purch_amt,
    ord_date,
    customer_id,
    salesman_id
FROM
    orders
WHERE
    salesman_id IN (
        SELECT DISTINCT
            salesman_id
        FROM
            orders
        WHERE
            customer_id = 3007
    );
```

**Output:**

<img width="1353" height="478" alt="image" src="https://github.com/user-attachments/assets/9a6918d8-34a2-46a8-8ed9-709852e76958" />


**Question 6**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
-- 

```sql
SELECT
    A.ord_no,
    A.purch_amt,
    A.ord_date,
    A.customer_id,
    A.salesman_id
FROM
    orders A
JOIN
    salesman B
ON
    A.salesman_id = B.salesman_id
WHERE
    B.city = 'London';
```

**Output:**

<img width="1252" height="412" alt="image" src="https://github.com/user-attachments/assets/329dee1b-56a2-4f77-80ff-032a6b030472" />



**Question 7**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)
<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/e4563f3c-b0ab-4d09-8be4-506748a2a550" />


-- 

```sql
SELECT student_name, grade
FROM GRADES
WHERE (subject, grade) IN (
    SELECT subject, MAX(grade)
    FROM GRADES
    GROUP BY subject
);
```

**Output:**

<img width="853" height="381" alt="image" src="https://github.com/user-attachments/assets/4fd04424-fbdf-4415-9c07-b175b00a5f2c" />



**Question 8**
---
From the following tables, write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
-- 

```sql
SELECT
    T1.ord_no,
    T1.purch_amt,
    T1.ord_date,
    T1.salesman_id
FROM
    orders T1
INNER JOIN
    salesman T2
ON
    T1.salesman_id = T2.salesman_id
WHERE
    T2.commission = (
        SELECT
            MAX(commission)
        FROM
            salesman
    );
```

**Output:**

<img width="987" height="488" alt="image" src="https://github.com/user-attachments/assets/89e864ca-d812-4c4f-869f-61cfc0e6ebb4" />


**Question 9**
---
Write a SQL query to List departments with names longer than the average length

Departments Table (attributes: department_id, department_name)
<img width="866" height="134" alt="image" src="https://github.com/user-attachments/assets/78c02083-22e6-4d01-bfe6-3a0810d81b3f" />


--

```sql
SELECT department_id, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name))
    FROM Departments
);

```

**Output:**

<img width="660" height="417" alt="image" src="https://github.com/user-attachments/assets/07e81876-1dfe-4240-9ce3-c9674181b6c7" />


**Question 10**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)
<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/5057fefd-6f55-494e-801a-f81eb6f6417b" />


-- 

```sql
SELECT student_id, student_name, subject, grade
FROM GRADES
WHERE (subject, grade) IN (
    SELECT subject, MAX(grade)
    FROM GRADES
    GROUP BY subject
);
```

**Output:**

<img width="1331" height="460" alt="image" src="https://github.com/user-attachments/assets/b2321cf2-0bad-4427-a207-dd4799cd3d51" />





## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
